[{"content":"About Me 🧑‍💻 我叫JoeyMa，是一名菜鸡🐔前端程序员、公司社畜🐮🐎，实际开发经验1年\nAbout This Website 🌐 没事建个博客玩下\n","permalink":"https://joeyma-zh.github.io/about/","summary":"\u003ch2 id=\"about-me-\"\u003eAbout Me 🧑‍💻\u003c/h2\u003e\n\u003cp\u003e我叫JoeyMa，是一名菜鸡🐔前端程序员、公司社畜🐮🐎，实际开发经验1年\u003c/p\u003e\n\u003ch2 id=\"about-this-website-\"\u003eAbout This Website 🌐\u003c/h2\u003e\n\u003cp\u003e没事建个博客玩下\u003c/p\u003e","title":"About"},{"content":" 文章基于 React 18.3 版本\ncreatElement 耳熟能详 的 JSX，它是如何变成我们熟悉的 DOM 的？这归功于 React 的creatElement，学过 Vue 的都知道，它们连名字都一样，这个函数主要的作用都是近乎相同允许你在HTML中编写 JavaScript，唯一的区别就是 React 是静态的 dom，Vue 是动态的 dom，从编写的形式和语法上可以看出，React 更偏向于手动挡，Vue 则是自动挡。回到正题，React 的 createElement 更偏向于 JavaScript 的编写，因为 children 就在 prop 里面，而 Vue 是加了一层插槽。React 中 createElement 重要参数就是type和prop，接触过 Vue 的就很熟悉，其实就是日常 Vue 模版使用的标签和 props，所以 React 的 createElement 看起来像：\nconst element = React.createElement( type:\u0026#34;h1\u0026#34;, prop:{ title: \u0026#34;foo\u0026#34;, }, children: \u0026#34;Hello\u0026#34; ) 接着通过 React 它会变成这样的 DOM：\n\u0026lt;h1 title=\u0026#34;foo\u0026#34;\u0026gt;Hello\u0026lt;/h1\u0026gt; createElement 生成之后返回：返回的结构体叫做React 元素对象，它用于描述 UI 结构，这个产物最终会变成一个filber。\n{ type: \u0026#39;div\u0026#39;, props: { className: \u0026#39;container\u0026#39;, children: [ { type: \u0026#39;h1\u0026#39;, props: { children: \u0026#39;Hello, World!\u0026#39; } }, { type: \u0026#39;p\u0026#39;, props: { children: \u0026#39;This is a paragraph.\u0026#39; } } ] } } createElement 解析的内容从何而来？ 这里涉及到非常复杂的内容：Babel 的编译，babel 会帮助你把 JSX 文件编译成为可供解析的 JavaScript 代码，JSX 其实是一种语法糖，它允许在 JavaScript 环境中使用编写 HTML 结构的文件，但浏览器无法执行 JSX，因为它不是合法的 HTML 文件也不是合法的 JavaScript 代码，所以总的来说 JSX 是为了方便开发者的一种形式。\n解析 JSX 成为AST(抽象语法树) AST 是一种树状结构，表示代码的语法结构。 render 通过creatElement\n在 React 内部，实际上是这样的伪代码:找到根容器，并根据 dom 类型创建容器，然后赋值上 props，之后就是处理 children 节点，如果 children 是文本，那直接创建文本节点，如果子元素是数组，递归处理每个子元素。\nfunction render(element, container) { // 创建 DOM 元素 const node = document.createElement(element.type); // 设置属性 for (let propName in element.props) { if (propName !== \u0026#34;children\u0026#34;) { node[propName] = element.props[propName]; } } // 处理子元素 const children = element.props.children; if (typeof children === \u0026#34;string\u0026#34;) { // 如果子元素是文本，直接创建文本节点 const textNode = document.createTextNode(children); node.appendChild(textNode); } else if (Array.isArray(children)) { // 如果子元素是数组，递归处理每个子元素 children.forEach((child) =\u0026gt; render(child, node)); } // 挂载到容器 container.appendChild(node); } // 使用示例 const element = { type: \u0026#34;div\u0026#34;, props: { className: \u0026#34;container\u0026#34;, children: \u0026#34;Hello, World!\u0026#34;, }, }; const container = document.getElementById(\u0026#34;root\u0026#34;); render(element, container); Concurrent Mode（并发模式） 在浏览器刚开始渲染的时候，会阻塞主线程直到元素树渲染完成，通常如果元素树比较大会占用大量的时间，导致部分优先级操作（用户输入 、动画）等高级调度会被阻塞，所以 React 团队为了解决这个问题，将每个小任务分为单元，当浏览器的时候需要执行用户输入时，会中断渲染进场，等调度完成各单元继续工作。我们使用requestIdleCallback构建一个递归，当浏览器有空闲时执行回调函数(理解如同 setTimeout);\nperformUnitOfWork 处理每个 Fiber 节点的操作，处理完成后返回下一个要处理的工作单元\n这里的 Fiber 节点是 React 实现虚拟 DOM 节点的形式\n由 Filber 节点构建的树称为 Filber 树。\n参考文献 构建你自己的 React (pomb.us) React 技术揭秘 (gitee.io) React18 正式版源码级剖析 - 掘金 (juejin.cn) 推荐先看 React 官网的：React 哲学 – React 中文文档 (docschina.org)\n","permalink":"https://joeyma-zh.github.io/posts/touch-react/","summary":"\u003cblockquote\u003e\n\u003cp\u003e文章基于 React 18.3 版本\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"createlement\"\u003ecreatElement\u003c/h2\u003e\n\u003cp\u003e耳熟能详 的 JSX，它是如何变成我们熟悉的 DOM 的？这归功于 React 的\u003ca href=\"https://zh-hans.react.dev/reference/react/createElement#createelement\"\u003ecreatElement\u003c/a\u003e，学过 Vue 的都知道，它们连名字都一样，这个函数主要的作用都是近乎相同允许你在\u003ccode\u003eHTML\u003c/code\u003e中编写 JavaScript，唯一的区别就是 React 是静态的 dom，Vue 是动态的 dom，从编写的形式和语法上可以看出，React 更偏向于手动挡，Vue 则是自动挡。回到正题，React 的 createElement 更偏向于 JavaScript 的编写，因为 children 就在 prop 里面，而 Vue 是加了一层插槽。React 中 createElement 重要参数就是\u003ccode\u003etype\u003c/code\u003e和\u003ccode\u003eprop\u003c/code\u003e，接触过 Vue 的就很熟悉，其实就是日常 Vue 模版使用的标签和 props，所以 React 的 createElement 看起来像：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kr\"\u003econst\u003c/span\u003e \u003cspan class=\"nx\"\u003eelement\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nx\"\u003eReact\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecreateElement\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;h1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"nx\"\u003eprop\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003etitle\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;foo\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003echildren\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Hello\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e接着通过 React 它会变成这样的 DOM：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"nt\"\u003eh1\u003c/span\u003e \u003cspan class=\"na\"\u003etitle\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;foo\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003eHello\u003cspan class=\"p\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"nt\"\u003eh1\u003c/span\u003e\u003cspan class=\"p\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003ecreateElement 生成之后返回：返回的结构体叫做\u003cstrong\u003eReact 元素对象\u003c/strong\u003e，它用于描述 UI 结构，这个产物最终会变成一个\u003ccode\u003efilber\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-js\" data-lang=\"js\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;div\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003eclassName\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;container\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nx\"\u003echildren\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;h1\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"nx\"\u003echildren\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;Hello, World!\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003etype\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;p\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nx\"\u003eprops\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"nx\"\u003echildren\u003c/span\u003e\u003cspan class=\"o\"\u003e:\u003c/span\u003e \u003cspan class=\"s1\"\u003e\u0026#39;This is a paragraph.\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"createelement-解析的内容从何而来\"\u003ecreateElement 解析的内容从何而来？\u003c/h3\u003e\n\u003cp\u003e这里涉及到非常复杂的内容：\u003cstrong\u003eBabel 的编译\u003c/strong\u003e，babel 会帮助你把 JSX 文件编译成为可供解析的 JavaScript 代码，JSX 其实是一种语法糖，它允许在 JavaScript 环境中使用编写 HTML 结构的文件，但浏览器无法执行 JSX，因为它不是合法的 HTML 文件也不是合法的 JavaScript 代码，所以总的来说 JSX 是为了方便开发者的一种形式。\u003c/p\u003e","title":"Touch React"}]